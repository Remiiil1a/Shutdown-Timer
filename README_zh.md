# 定时关机程序

## 功能强大的Windows定时关机工具，新增窗口监视功能...

---

### 注意:

### *1. 程序需要关机权限，建议以管理员身份运行*
### *2. 本项目的大部分代码由deepseek编写，是一个练习项目*
### *3. 使用本程序造成的任何后果由使用方自行承担*

---

## 功能特点

### 🚀 核心功能
- ⏰ **定时操作**：支持0-1440分钟（24小时）内的定时
- 🔄 **三种操作**：支持关机、重启、注销三种操作
- 🪟 **窗口监视**：新增窗口监视功能，窗口关闭后自动启动3分钟倒计时
- 🔔 **智能提醒**：倒计时3分钟时自动显示提醒通知
- 📊 **实时显示**：主窗口和托盘图标实时显示剩余时间
- 🗔 **系统托盘**：支持最小化到系统托盘，托盘图标右键菜单
- 🔒 **锁屏静默**：系统锁定时不弹出提醒，避免打扰

### 🎨 用户界面
- 🎨 **现代化设计**：简洁的白色背景，深灰色文字
- 📱 **DPI自适应**：支持高DPI显示器
- 📍 **托盘集成**：完整的托盘图标功能
- 🔄 **状态提示**：清晰的状态提示和倒计时显示
- 🔍 **直观操作**：简单的窗口选择机制

---

## 使用方法

### 基本定时功能
1. 运行程序（建议以管理员身份运行）
2. 在"操作延迟时间"输入框中输入分钟数（0-1440）
   - 输入0表示立即执行操作
   - 最大支持24小时（1440分钟）
3. 选择操作类型：关机、重启或注销
4. 点击"▶ 开始定时"按钮

### 🪟 窗口监视功能
1. 点击"🔍 选择要监视的窗口"按钮
2. 鼠标变为十字准星，点击要监视的任意窗口
3. 程序开始监视该窗口，状态栏显示监视信息
4. 当监视的窗口关闭时，自动启动3分钟倒计时
5. 倒计时结束后执行选定的操作

### 取消定时任务
- 点击主窗口中的"⏹ 取消操作"按钮
- 或在系统托盘图标右键菜单中选择"⛔ 终止倒计时"

### 取消窗口监视
- 点击主窗口中的"🗑 清除监视"按钮
- 或在系统托盘图标右键菜单中选择"🚫 取消窗口监视"

### 系统托盘操作
- **左键单击**：显示/隐藏主窗口
- **右键单击**：显示上下文菜单
  - 🔲 显示窗口
  - 🚫 取消窗口监视（仅在监视窗口时显示）
  - ⛔ 终止倒计时（仅在倒计时运行时显示）
  - ❌ 退出程序

### 关闭选项
点击窗口关闭按钮时，会弹出选项：
- **是(Y)** - 完全退出程序
- **否(N)** - 隐藏到系统托盘
- **取消** - 返回程序

---

## 技术细节

### 编译要求
- Windows SDK (Windows 7及以上)
- C++编译器（支持Windows API）
- 需要链接 `comctl32.lib`

### 权限要求
程序需要以下权限：
- 关机权限（建议管理员运行）
- 系统托盘访问权限
- 注册互斥体防止多开

### 系统要求
- Windows 7 或更高版本
- 支持Unicode
- 支持Common Controls 6.0

---

## 特殊功能说明

### 窗口监视功能
- **自动触发**：被监视窗口关闭后自动启动3分钟倒计时
- **智能提示**：窗口关闭时显示详细提示信息
- **防止重复**：防止重复通知和重复启动倒计时
- **状态反馈**：在系统托盘中显示监视状态

### 3分钟提醒功能
- 倒计时剩余3分钟时自动显示提醒
- 系统锁定时自动跳过提醒，避免打扰
- 支持系统托盘气泡通知和消息框提醒

### 操作特性
- **关机/重启**：强制模式，不等待应用程序关闭
- **注销**：强制注销当前用户会话
- **锁屏兼容**：在系统锁定时继续倒计时但不显示提醒

### 互斥功能
- **倒计时与监视互斥**：不能同时进行窗口监视和手动倒计时
- **智能状态管理**：根据当前状态自动启用/禁用相关控件
- **防止冲突**：确保程序状态一致性

---

## 常见问题

### Q: 程序无法关机/重启怎么办？
A: 请尝试以管理员身份运行程序，程序会自动检测管理员权限并给出提示。

### Q: 程序可以多开吗？
A: 不可以，程序使用互斥体防止多开。

### Q: 可以同时进行窗口监视和手动倒计时吗？
A: 不可以，这两个功能是互斥的，只能同时使用一个。

### Q: 窗口监视对所有窗口都有效吗？
A: 大部分窗口都支持，但某些特殊系统窗口可能无法正常监视。

### Q: 窗口关闭后倒计时可以取消吗？
A: 可以，在3分钟倒计时期间可以随时取消。

### Q: 如何完全退出程序？
A: 可以通过托盘菜单退出，或关闭窗口时选择"是(Y)"。

### Q: 系统锁定时还会显示3分钟提醒吗？
A: 不会，系统锁定时程序会自动检测并跳过提醒，避免打扰。

---

## 开发说明

### 代码结构
- 使用纯Win32 API开发，无外部依赖
- 支持Unicode和多语言
- 完整错误处理和用户体验优化
- 新增窗口监视相关函数模块

---

[返回主页面]() | [查看英文版本](README_en.md)
